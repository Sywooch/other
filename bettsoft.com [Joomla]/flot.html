<?php
//SESSION_START();
mysql_connect("localhost", "045806063_web", "Admin123");
mysql_select_db("bohatko_web");
require_once "/home/users2/b/bohatko/domains/bettsoft.com/joomla.php";
$user = JFactory::getUser(); 
if ($user->guest) {
//перенаправление на страницу авторизации
echo'
<script type="text/javascript"> 
  window.location.href = "/account/pages/examples/login.html";
</script>
';
exit();
} else{
$_ids=$user->id;
$y = mysql_query("SELECT * FROM `uxsg3_users` WHERE `id` = '".$_ids."'");
$f = mysql_fetch_assoc($y);
} 
?>
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Онлайн сканирование</title>
        <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <!-- Ionicons -->
        <link href="//code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css" rel="stylesheet" type="text/css" />
        <!-- Theme style -->
        <link href="../../css/AdminLTE.css" rel="stylesheet" type="text/css" />

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
          <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
    </head>
   <body class="skin-blue">
   

<?php
$podpiska_pay=0;
//если значение равно 0, то подписка не оплачена
//если значение равно 1, то подписка оплачена

?> 
	
<?php
	
$y2 = mysql_query("SELECT * FROM `uxsg3_users_podpiska` WHERE `id_user` = '".$_ids."'");
													$f2 = mysql_fetch_assoc($y2);
													$user_date=$f2['date'];//год-месяц-день
													$user_time=$f2['time'];
													
													
													//$user_date="2014-10-29";
													//$user_time="24:44:00";
													if(($user_date=="0000-00-00")&&($user_time=="00:00:00")){
													//подписка не оплачена
													//echo "width: 100%";
													$progress_rodp=100;
													//echo $progress_rodp."%";
													
													}else{
													//подписка когда-то была оплачена, надо проверить, сколько ещё осталось.
													//вычисление сегодняшних даты и времени.
													$timestamp_today = time();
													$tmp_time=$user_date."T".$user_time;
													$timestamp_user = strtotime($tmp_time);
													
													$timestamp_user = intval($timestamp_user); 
													$timestamp_today = intval($timestamp_today);
													
														if ($timestamp_today && $timestamp_user)  {
														$time_lapse = $timestamp_today - $timestamp_user;
														}
														
														$diff_hours=$time_lapse/3600;//разница в часах 
														//между сегодняшним днём и датой последней оплаты подписки
														$diff_hours=round($diff_hours); 
														
													//в 30 сутках 720 часов.
													$progress_rodp=($diff_hours*100)/720;
													$progress_rodp=round($progress_rodp, 2); 
													//echo $progress_rodp."%";
													
													if($progress_rodp<100){ $podpiska_pay=1; }//с подпиской всё в порядке
													
													}
?>
	
 
  
        <!-- header logo: style can be found in header.less -->
        <header class="header">
            <a href="/account/index.html" class="logo">
                <!-- Add the class icon to your logo image or logo icon to add the margining -->
                Кабинет
            </a>
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top" role="navigation">
                <!-- Sidebar toggle button-->
                <a href="#" class="navbar-btn sidebar-toggle" data-toggle="offcanvas" role="button">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <div class="navbar-right">
                    <ul class="nav navbar-nav">
                        <!-- Messages: style can be found in dropdown.less-->
                        
                        <!-- Notifications: style can be found in dropdown.less -->
                      
                        </li>

                        <!-- User Account: style can be found in dropdown.less -->
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="glyphicon glyphicon-user"></i>
                                <span><?php echo iconv("windows-1251", "utf-8", $f[name]); ?>  <i class="caret"></i></span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header bg-light-blue">
                                    <img src="/account/avatar.jpg" class="img-circle" alt="User Image" />
                                    <p>
                                       Здравствуйте, <?php echo iconv("windows-1251", "utf-8", $f[name]); ?> !
                                        <small></small>
                                    </p>
                                </li>
                                <!-- Menu Body -->
                                <li class="user-body">
                                   <div class="col-xs-12 text-center">
									<?php
									if($podpiska_pay==1){
									?>
									Подписка активна&nbsp
									<?php
									}else{
									?>
                                      Подписка неактивна&nbsp  <a href="/account/oplata.html" class="btn btn-default btn-flat">Продлить</a>
                                    <?php
									}
									?>
									</div>
                                     
                                </li>
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a href="/account/pages/UI/sliders.html" class="btn btn-default btn-flat">Настройки</a>
                                    </div>
                                    <div class="pull-right">
                                        <a href="http://bettsoft.com/?c=1" class="btn btn-default btn-flat">Выход</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <div class="wrapper row-offcanvas row-offcanvas-left">
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="left-side sidebar-offcanvas">
                <!-- sidebar: style can be found in sidebar.less -->
                <section class="sidebar">
                    <!-- Sidebar user panel -->
                    
                    <!-- search form -->
                    
                    <!-- /.search form -->
                    <!-- sidebar menu: : style can be found in sidebar.less -->
                    <ul class="sidebar-menu">
                        <li>
                            <a href="/account/index.html">
                                <i class="fa fa-user"></i> <span>Панель управления</span>
                            </a>
                        </li>
                        <li>
                            <a href="http://bettsoft.com/account/partnerka.php">
                                <i class="fa fa-user"></i> <span>Партнерская</span><small class="badge pull-right bg-yellow">new</small>
                            </a>
                        </li>
                        <li>
                            <a href="/account/pages/charts/flot.html">
                                <i class="fa fa-th"></i> <span class="fa-active">Сканер ошибок</span> <small class="badge pull-right bg-green">online</small>
                            </a>
                            
                        
                        </li>
                        <li>
                            <a href="/account/pages/UI/sliders.html">
                                <i class="fa fa-wrench"></i> <span>Настройки отправки</span>
                                
                            </a>
                           
                        </li>
                        <li>
                            <a href="/account/pages/forms/general.html">
                                <i class="fa fa-tachometer"></i> <span>Скорость интернета</span> <small class="badge pull-right bg-red">!</small>
                            </a>
                            
                        
                        </li>
                        <li>
                            <a href="/account/sport_onlile.php#inscore_ifheight_xdc_3101">
                                <i class="fa fa-trophy"></i> <span>Результаты онлайн</span>
                                
                            </a>
                        </li>
                        
                        <li>
                            <a href="/account/pages/UI/timeline.html">
                                <i class="fa fa-edit"></i> <span>Обучение</span>
                                
                            </a>
                            
                        </li>
                         
                        
                        <li>
                            <a href="/account/prilozhenie.html">
                                <i class="fa fa-tablet"></i> <span>Мобильное приложение</span>
                                
                            </a>
                            
                        </li>
                        
                        
                    </ul>
                </section>
                
            <!-- /.sidebar -->
            </aside>
            
            
            
            
            <!-- Right side column. Contains the navbar and content of the page -->
            <aside class="right-side">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <div class="callout callout-info">
                                        <h4>Программа подключена к БС..</h4>
                                        <p>Идет определение максимальных показателей задержки в секундах.
                        На графике отображжаются задержка обновления результатов в течении 60 секунд,  если показатель больше 15 секунд - автоматически отправляется сообщение подписчикам.  
                            Вы можете настроить отправку под себя в личном кабинете(время отправки, количество смс в сутки) </p>
                                    </div>
                        
                        
                    
                   
                </section>

                <!-- Main content -->
                <section class="content">
                    <div class="row">
                        <div class="col-xs-12">
                            <!-- interactive chart -->
                            <div class="box box-primary">
                                <div class="box-header">
                                    <i class="fa fa-bar-chart-o"></i>
                                    <h3 class="box-title">Сканирование теннисных матчей в режиме онлайн </h3>
                                    <div class="box-tools pull-right">
                                      
                                        <div class="btn-group" id="realtime" data-toggle="btn-toggle">
                                            <button type="button" class="btn btn-default btn-xs active" data-toggle="on">Вкл</button>
                                            <button type="button" class="btn btn-default btn-xs" data-toggle="off">Остановить</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="box-body">
                                    <div id="interactive" style="height: 300px;"></div>
                                </div><!-- /.box-body-->
                            </div><!-- /.box -->

                            <!-- Bar chart -->
                            <div class="box box-primary">
                                <div class="box-header">
                                    <i class="fa fa-bar-chart-o"></i>
                                    <h3 class="box-title">Отправлено СМС (по суткам)</h3>
                                </div>
                                <div class="box-body">
                                    <div id="bar-chart" style="height: 300px;"></div>
                                </div><!-- /.box-body-->
                            </div><!-- /.box -->

                        </div><!-- /.col -->
                    </div><!-- /.row -->
                </section><!-- /.content -->
            </aside><!-- /.right-side -->
        </div><!-- ./wrapper -->

        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script>
        <!-- AdminLTE App -->
        <script src="../../js/AdminLTE/app.js" type="text/javascript"></script>
        <!-- AdminLTE for demo purposes -->
       
        <!-- FLOT CHARTS -->
        <script src="../../js/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
        <!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized -->
        <script src="../../js/plugins/flot/jquery.flot.resize.min.js" type="text/javascript"></script>
        <!-- FLOT PIE PLUGIN - also used to draw donut charts -->
        <script src="../../js/plugins/flot/jquery.flot.pie.min.js" type="text/javascript"></script>
        <!-- FLOT CATEGORIES PLUGIN - Used to draw bar charts -->
        <script src="../../js/plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>

        <!-- Page script -->
        <script type="text/javascript">

            $(function() {

                /*
                 * Flot Interactive Chart
                 * -----------------------
                 */
                // We use an inline data source in the example, usually data would
                // be fetched from a server
                var data = [], totalPoints = 300;
                function getRandomData() {

                    if (data.length > 0)
                        data = data.slice(1);

                    // Do a random walk
                    while (data.length < totalPoints) {

                        var prev = data.length > 0 ? data[data.length - 1] : 10,
                                y = prev + Math.random() * 10 - 5;

                        if (y < 0) {
                            y = 0;
                        } else if (y > 9) {
                            y = 5;
                        }

                        data.push(y);
                    }

                    // Zip the generated y values with the x values
                    var res = [];
                    for (var i = 0; i < data.length; ++i) {
                        res.push([i, data[i]]);
                    }

                    return res;
                }

                var interactive_plot = $.plot("#interactive", [getRandomData()], {
                    grid: {
                        borderColor: "#f3f3f3",
                        borderWidth: 1,
                        tickColor: "#f3f3f3"
                    },
                    series: {
                        shadowSize: 0, // Drawing is faster without shadows
                        color: "#3c8dbc"
                    },
                    lines: {
                        fill: true, //Converts the line chart to area chart
                        color: "#3c8dbc"
                    },
                    yaxis: {
                        min: 0,
                        max: 30,
                        show: true
                    },
                    xaxis: {
                        min: 0,
                        max: 60,
                        show: true
                    }
                });

                var updateInterval = 1000; //Fetch data ever x milliseconds
                var realtime = "on"; //If == to on then fetch data every x seconds. else stop fetching
                function update() {

                    interactive_plot.setData([getRandomData()]);

                    // Since the axes don't change, we don't need to call plot.setupGrid()
                    interactive_plot.draw();
                    if (realtime === "on")
                        setTimeout(update, updateInterval);
                }

                //INITIALIZE REALTIME DATA FETCHING
                if (realtime === "on") {
                    update();
                }
                //REALTIME TOGGLE
                $("#realtime .btn").click(function() {
                    if ($(this).data("toggle") === "on") {
                        realtime = "on";
                    }
                    else {
                        realtime = "off";
                    }
                    update();
                });
                /*
                 * END INTERACTIVE CHART
                 */


                

                /*
                 * BAR CHART
                 * ---------
                 */




               


//alert(bar_data[data][0]);

var d = new Date();


//если текущее время после 23-00 то показывать график, начиная с сегодняшнего дня.


var hours = d.getHours();
 
//alert(hours);
if(hours>=23){
d.setDate(d.getDate());
}else{
d.setDate(d.getDate()-1);
}
//


var today_year=d.getFullYear();
var today_mon=d.getMonth();
today_mon=today_mon+1;
var today_day=d.getDate();
var random=Math.abs(Math.ceil(((today_mon+today_day)/2)));


//
d.setDate(d.getDate()-1);

var today_year_15=d.getFullYear();
var today_mon_15=d.getMonth();
today_mon_15=today_mon_15+1;
var today_day_15=d.getDate();
var random_15=Math.abs(Math.ceil(((today_mon_15+today_day_15)/2)));

d.setDate(d.getDate()-1);

var today_year_14=d.getFullYear();
var today_mon_14=d.getMonth();
today_mon_14=today_mon_14+1;
var today_day_14=d.getDate();
var random_14=Math.abs(Math.ceil(((today_mon_14+today_day_14)/2)));

d.setDate(d.getDate()-1);

var today_year_13=d.getFullYear();
var today_mon_13=d.getMonth();
today_mon_13=today_mon_13+1;
var today_day_13=d.getDate();
var random_13=Math.abs(Math.ceil(((today_mon_13+today_day_13)/2)));

d.setDate(d.getDate()-1);

var today_year_12=d.getFullYear();
var today_mon_12=d.getMonth();
today_mon_12=today_mon_12+1;
var today_day_12=d.getDate();
var random_12=Math.abs(Math.ceil(((today_mon_12+today_day_12)/2)));


d.setDate(d.getDate()-1);

var today_year_11=d.getFullYear();
var today_mon_11=d.getMonth();
today_mon_11=today_mon_11+1;
var today_day_11=d.getDate();
var random_11=Math.abs(Math.ceil(((today_mon_11+today_day_11)/2)));

d.setDate(d.getDate()-1);

var today_year_10=d.getFullYear();
var today_mon_10=d.getMonth();
today_mon_10=today_mon_10+1;
var today_day_10=d.getDate();
var random_10=Math.abs(Math.ceil(((today_mon_10+today_day_10)/2)));

 var bar_data = {
                    data: [[""+today_day_10+"/"+today_mon_10+"/"+today_year_10+"", ""+random_10+""], [""+today_day_11+"/"+today_mon_11+"/"+today_year_11+"", ""+random_11+""], [""+today_day_12+"/"+today_mon_12+"/"+today_year_12+"", ""+random_12+""], [""+today_day_13+"/"+today_mon_13+"/"+today_year_13+"", ""+random_13+""], [""+today_day_14+"/"+today_mon_14+"/"+today_year_14+"", ""+random_14+""], [""+today_day_15+"/"+today_mon_15+"/"+today_year_15+"", ""+random_10+""], [""+today_day+"/"+today_mon+"/"+today_year+"", ""+random+""]],
                    color: "#3c8dbc"
                };




                $.plot("#bar-chart", [bar_data], {
                    grid: {
                        borderWidth: 1,
                        borderColor: "#f3f3f3",
                        tickColor: "#f3f3f3"
                    },
                    series: {
                        bars: {
                            show: true,
                            barWidth: 0.5,
                            align: "center"
                        }
                    },
                    xaxis: {
                        mode: "categories",
                        tickLength: 0
                    }
                });
                /* END BAR CHART */

               

            });

            /*
             * Custom Label formatter
             * ----------------------
             */
            function labelFormatter(label, series) {
                return "<div style='font-size:13px; text-align:center; padding:2px; color: #fff; font-weight: 600;'>"
                        + label
                        + "<br/>"
                        + Math.round(series.percent) + "%</div>";
            }
        </script>
    </body>
</html>
