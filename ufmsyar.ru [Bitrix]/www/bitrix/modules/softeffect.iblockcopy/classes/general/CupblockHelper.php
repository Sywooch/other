<?class CupblockHelper {	function GetIBlockDropDownList($IBLOCK_ID, $IBLOCK_SECTION_ID, $strTypeName, $strIBlockName, $strSectionName, $arFilter = false)	{		$html = '';		static $arTypes = false;		static $arIBlocks = false;		static $arSections = false;		if(!$arTypes)		{			$arTypes = array(''=>GetMessage("IBLOCK_CHOOSE_IBLOCK_TYPE"));			$arIBlocks = array(''=>array(''=>GetMessage("IBLOCK_CHOOSE_IBLOCK")));			$arSections = array(''=>array(''=>GetMessage("IBLOCK_CHOOSE_SECTION")));			if(!is_array($arFilter))				$arFilter = array();			$arFilter["MIN_PERMISSION"] = "W";						$rsIBlocks = CIBlock::GetList(array("IBLOCK_TYPE" => "ASC", "NAME" => "ASC"), $arFilter);			while($arIBlock = $rsIBlocks->Fetch())			{				if(!array_key_exists($arIBlock["IBLOCK_TYPE_ID"], $arTypes))				{					$arType = CIBlockType::GetByIDLang($arIBlock["IBLOCK_TYPE_ID"], LANG);					$arTypes[$arType["~ID"]] = $arType["~NAME"]." [".$arType["~ID"]."]";					$arIBlocks[$arType["~ID"]] = array(''=>GetMessage("IBLOCK_CHOOSE_IBLOCK"));				}				$arIBlocks[$arIBlock["IBLOCK_TYPE_ID"]][$arIBlock["ID"]] = $arIBlock["NAME"]." [".$arIBlock["ID"]."]";			}						$arFilter["MIN_PERMISSION"] = "W";			$rsSections = CIBlockSection::GetTreeList($arFilter);			while($arSection = $rsSections->Fetch()) {				$value = '';				for ($i = 0; $i < $arSection['DEPTH_LEVEL'] - 1; $i++) {					$value .= '.';				}				$value = $value.$arSection['NAME'];				$arSections[$arSection['IBLOCK_ID']][$arSection['ID']] = $value;			}			$html .= '			<script language="JavaScript">			function OnTypeChanged(typeSelect, iblockSelectID)			{				var arIBlocks = '.CUtil::PhpToJSObject($arIBlocks).';				var iblockSelect = document.getElementById(iblockSelectID);				if(iblockSelect)				{					for(var i=iblockSelect.length-1; i >= 0; i--)						iblockSelect.remove(i);					var n = 0;					for(var j in arIBlocks[typeSelect.value])					{						var newoption = new Option(arIBlocks[typeSelect.value][j], j, false, false);						iblockSelect.options[n]=newoption;						n++;					}				}								OnIBlockChanged(iblockSelect, "'.htmlspecialchars($strSectionName).'");			}			function OnIBlockChanged(iblockSelect, sectionSelectID) 			{				var arSections = '.CUtil::PhpToJSObject($arSections).';				var sectionSelect = document.getElementById(sectionSelectID);				if(sectionSelect)				{					for(var i=sectionSelect.length-1; i > 0; i--)						sectionSelect.remove(i);					var n = 1;										if (iblockSelect.value != "") {						for(var j in arSections[iblockSelect.value])						{							var newoption = new Option(arSections[iblockSelect.value][j], j, false, false);							sectionSelect.options[n]=newoption;							n++;						}					}				}			}			</script>			';		}		$IBLOCK_TYPE = false;		if($IBLOCK_ID > 0)		{			foreach($arIBlocks as $iblock_type_id => $iblocks)			{				if(array_key_exists($IBLOCK_ID, $iblocks))				{					$IBLOCK_TYPE = $iblock_type_id;					break;				}			}		}		$html .= '<tr><td align="right">'.GetMessage("IBLOCKCOPI_STEP_TIP").'</td><td colspan="2"><select name="'.htmlspecialchars($strTypeName).'" id="'.htmlspecialchars($strTypeName).'" OnChange="'.htmlspecialchars('OnTypeChanged(this, \''.CUtil::JSEscape($strIBlockName).'\')').'">'."\n";				foreach($arTypes as $key => $value)		{			if($IBLOCK_TYPE === false)				$IBLOCK_TYPE = $key;			$html .= '<option value="'.htmlspecialchars($key).'"'.($IBLOCK_TYPE===$key? ' selected': '').'>'.htmlspecialchars($value).'</option>'."\n";		}		$html .= "</select></td></tr>\n";		$html .= "&nbsp;\n";		$html .= '<tr><td align="right">'.GetMessage("IBLOCKCOPI_STEP_BL").'</td><td><select name="'.htmlspecialchars($strIBlockName).'" id="'.htmlspecialchars($strIBlockName).'" OnChange="'.htmlspecialchars('OnIBlockChanged(this, \''.CUtil::JSEscape($strSectionName).'\')').'">'."\n";		foreach($arIBlocks[$IBLOCK_TYPE] as $key => $value)		{			$html .= '<option value="'.htmlspecialchars($key).'"'.($IBLOCK_ID==$key? ' selected': '').'>'.htmlspecialchars($value).'</option>'."\n";		}				return $html;	}		function GetIBlockDropDownList1($IBLOCK_ID, $IBLOCK_SECTION_ID, $strTypeName, $strIBlockName, $strSectionName, $arFilter = false)	{		$html = '';		static $arTypes = false;		static $arIBlocks = false;		static $arSections = false;		if(!$arTypes)		{			$arTypes = array(''=>GetMessage("IBLOCK_CHOOSE_IBLOCK_TYPE"));			$arIBlocks = array(''=>array(''=>GetMessage("IBLOCK_CHOOSE_IBLOCK")));			$arSections = array(''=>array(''=>GetMessage("IBLOCK_CHOOSE_SECTION")));			if(!is_array($arFilter))				$arFilter = array();			$arFilter["MIN_PERMISSION"] = "W";						$dbType = CIBLockType::GetList(array('SORT'=>'ASC'), array());			while ($arType = $dbType->GetNext()) {				$arType = CIBlockType::GetByIDLang($arType["ID"], LANG);				$arTypes[$arType["ID"]] = $arType["NAME"]." [".$arType["ID"]."]";				$arFilter['TYPE'] = $arType["ID"];								$rsIBlocks = CIBlock::GetList(array("IBLOCK_TYPE" => "ASC", "NAME" => "ASC"), $arFilter);				if ($rsIBlocks->SelectedRowsCount()) {					while($arIBlock = $rsIBlocks->Fetch())					{						$arIBlocks[$arType["ID"]][$arIBlock["ID"]] = $arIBlock["NAME"]." [".$arIBlock["ID"]."]";					}				} else {					$arIBlocks[$arType["ID"]]=FALSE;				}			}			//echo "<pre>"; print_r($arIBlocks); echo "</pre>";						$arFilter["MIN_PERMISSION"] = "W";			$rsSections = CIBlockSection::GetTreeList($arFilter);			while($arSection = $rsSections->Fetch()) {								$value = '';				for ($i = 0; $i < $arSection['DEPTH_LEVEL'] - 1; $i++) {					$value .= '.';				}				$value = $value.$arSection['NAME'];				$arSections[$arSection['IBLOCK_ID']][$arSection['ID']] = $value;			}			$html .= '			<script language="JavaScript">			function OnTypeChanged1(typeSelect, iblockSelectID)			{				var arIBlocks = '.CUtil::PhpToJSObject($arIBlocks).';				var iblockSelect = document.getElementById(iblockSelectID);				var NewBlockO = document.getElementById("NewBlockO")				var selectedNew = document.getElementById("selectNew");								if (arIBlocks[typeSelect.value]!==false) {					NewBlockO.value="";					NewBlockO.disabled="disabled";										selectedNew[0].selected="selected";					selectedNew[1].selected=false;										iblockSelect.disabled=false;										if(iblockSelect)					{						for(var i=iblockSelect.length-1; i >= 0; i--)							iblockSelect.remove(i);						var n = 0;						for(var j in arIBlocks[typeSelect.value])						{							var newoption = new Option(arIBlocks[typeSelect.value][j], j, false, false);							iblockSelect.options[n]=newoption;							n++;						}					}				} else {					for(var i=iblockSelect.length-1; i > 0; i--)						iblockSelect.remove(i);										selectedNew[1].selected="selected";										text_null = "'.GetMessage("IBLOCK_CHOOSE_IBLOCK").'";					text_null = text_null.split("(").join("\(");					text_null = text_null.split(")").join("\)");										var newoption = new Option(text_null, 0, false, false);					iblockSelect.options[0]=newoption;										NewBlockO.disabled=false;										iblockSelect.disabled="disabled";				}								OnIBlockChanged1(iblockSelect, "'.htmlspecialchars($strSectionName).'");			}			function OnIBlockChanged1(iblockSelect, sectionSelectID) 			{				var arSections = '.CUtil::PhpToJSObject($arSections).';				var sectionSelect = document.getElementById(sectionSelectID);				if(sectionSelect)				{					for(var i=sectionSelect.length-1; i > 0; i--)						sectionSelect.remove(i);					var n = 1;					if (iblockSelect.value != "") {						for(var j in arSections[iblockSelect.value])						{							var newoption = new Option(arSections[iblockSelect.value][j], j, false, false);							sectionSelect.options[n]=newoption;							n++;						}					}				}			}			</script>			';		}		$IBLOCK_TYPE = false;		if($IBLOCK_ID > 0)		{			foreach($arIBlocks as $iblock_type_id => $iblocks)			{				if(array_key_exists($IBLOCK_ID, $iblocks))				{					$IBLOCK_TYPE = $iblock_type_id;					break;				}			}		}		$html .= '<tr><td align="right">'.GetMessage("IBLOCKCOPI_STEP_TIP").'</td><td colspan="2"><select name="'.htmlspecialchars($strTypeName).'" id="'.htmlspecialchars($strTypeName).'" OnChange="'.htmlspecialchars('OnTypeChanged1(this, \''.CUtil::JSEscape($strIBlockName).'\')').'">'."\n";				foreach($arTypes as $key => $value)		{			if($IBLOCK_TYPE === false)				$IBLOCK_TYPE = $key;			$html .= '<option value="'.htmlspecialchars($key).'"'.($IBLOCK_TYPE===$key? ' selected': '').'>'.htmlspecialchars($value).'</option>'."\n";		}		$html .= "</select></td></tr>\n";		$html .= "&nbsp;\n";         		 		$html .= '<tr><td align="right">'.GetMessage("IBLOCKCOPI_STEP_BL").'</td><td><select style="width:233px" OnChange="Activ()" id="selectNew"><option value="1">'.GetMessage("IBLOCKCOPI_STEP_COOYS").'</option><option value="2">'.GetMessage("IBLOCKCOPI_STEP_CREATN").'</option></select></td><td><select name="'.htmlspecialchars($strIBlockName).'" id="'.htmlspecialchars($strIBlockName).'" OnChange="'.htmlspecialchars('OnIBlockChanged(this, \''.CUtil::JSEscape($strSectionName).'\')').'">'."\n";				foreach($arIBlocks[$IBLOCK_TYPE] as $key => $value)		{			$html .= '<option value="'.htmlspecialchars($key).'"'.($IBLOCK_ID==$key? ' selected': '').'>'.htmlspecialchars($value).'</option>'."\n";		}		return $html;	}		// sohranyaet i vosstanavlivaet znachenie parametra shaga iz sessii	function saveParamStep($name) {		global $USER;				if ($_REQUEST[$name]) {			$USER->SetParam($name, $_REQUEST[$name]);		}				return $USER->GetParam($name);	}}