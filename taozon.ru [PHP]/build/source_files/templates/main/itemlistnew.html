<script type="text/javascript">
    var overid = 0;

    function gettitle(lid) {
        if (lid != overid) return;
        var obj = $('#' + lid + ' ins.name');

        $.ajax({
            url:'index.php?p=itemtitle&itemid=' + obj.attr('pid'),
            success:function (data) {
                obj.html(data);
                obj.parent().attr('title', data);
                obj.closest('li').find('.pic').attr('title', data);
            },
            error:function (jqXHR, textStatus, errorThrown) {
                obj.html('');
            }
        });
    }

    $(function () {

        $('.product').mouseover(function () {
            if (overid != $(this).attr('id')) {
                overid = $(this).attr('id');
                setTimeout('gettitle("' + overid + '")', 1000);
            }
        });
        $('.product').mouseout(function () {
            overid = 0;
        });
    });
</script>

<? if (isset($hintcats) && count($hintcats) > 0) { ?>
<div class="samecat">
    <div class="wrap clrfix">
        <div class="bproduct">
            <h2 class="mb20"><span><?=Lang::get('suitable_category')?></span></h2>
            <ul class="lcategory clrfix flin">
                <?
                $cid = RequestWrapper::getValueSafe('cid');
                $hasHidden = false;
                ?>
                <? foreach ($hintcats as $k => $category) { ?>
                <? if ($k < 10) { ?>
                    <li <?=($cat['id'] == $cid ? 'class="active"' : '')?>><a
                        href="index.php?p=category&cid=<?=$category['id'];?>"> <?=$category['name'];?></a></li>
                    <?
                } else {
                    $hasHidden = true;
                    ?>
                    <li class="fast-category-hidden"><a
                        href="index.php?p=category&cid=<?=$category['id'];?>"> <?=$category['name'];?></a></li>
                    <? } ?>
                <? } ?>
                <? if ($hasHidden) { ?>
					<li class="last"><a href="#" class="all dotted" onclick="$('.fast-category-hidden').show();$(this).remove();return false;"><i class="i arrowdown"></i><span>Еще категории</span></a></li>
                <? } ?>
            </ul>
        </div>
    </div>
</div>
<? } ?>

<!-- .main -->
<div class="main">
<div class="wrap clrfix">
<div class="bproduct">
<h2 class="mb25"><span><?=Lang::get('founded_goods')?></span></h2>

<div class="fll col240">
    <? if ($vendorInfo) { ?>
    <div class="bgr-block mb20">
        <table class="info f11">
            <tbody>
            <tr>
                <td><?=Lang::get('name')?>:</td>
                <td><b><?=$vendorInfo['name']?></b></td>
            </tr>
            <tr>
                <td><?=Lang::get('placed_in')?>:</td>
                <td><b><?=$vendorInfo['location']['city']?> (<?=$vendorInfo['location']['state']?>)</b></td>
            </tr>

            <tr>
                <td><?=Lang::get('features')?>:</td>
                <td><b><?=$vendorInfo['location']['city']?></b></td>
            </tr>

            <tr>
                <td><?=Lang::get('responses')?>:</td>
                <td><b><?=$vendorInfo['credit']['TotalFeedbacks']?></b></td>
            </tr>
            <tr>
                <td><?=Lang::get('positive')?>:</td>
                <td><b><?=$vendorInfo['credit']['PositiveFeedbacks']?></b></td>
            </tr>
            <tr class="raiting">
                <td><?=Lang::get('rating')?>:</td>
                <td><i class="i price_icon"></i> <?=$vendorInfo['credit']['level']?></td>
            </tr>
            </tbody>
        </table>
    </div>
    <? } ?>
    <div class="bgr-block mb20" id="active-search-prop">
        <div class="titlecat"><?=Lang::get('active_cond')?></div>
        <ul class="listitem" id="clear-filter">
            <li class="dropterms clrfix">
                <a href="<?=$_SERVER['REQUEST_URI'] . '&clear'?>"
                   class="btn-small btn-delete fll"><span><?=Lang::get('reset_cond')?></span></a>
            </li>
        </ul>
    </div>
    <div class="bgr-block mb20">
        <div class="titlecat"><?=Lang::get('supplier_type')?></div>
        <? $class_all = ($tmall == "true") ? '' : 'active'; ?>
        <? $class_tmall = ($tmall == "true") ? 'active' : ''; ?>
        <ul class="listitem">
            <li><a href="<?=str_replace('&tmall=true', '', $pageurl)?>"
                   class="<?=$class_all?>"><?=Lang::get('all_suppliers')?></a></li>
            <li><a href="<?=$pageurl?>&tmall=true" class="<?=$class_tmall?>"><?=Lang::get('tmall')?></a></li>
        </ul>
    </div>
   
    <? if ($_GET['tmall']) {        
      	$tmall='&tmall=true';
       } else {        
       	$tmall='';
       }
    ?>
    <? if (is_array(@$subcats)) { ?>
    <div class="bgr-block mb20">
        <div class="titlecat"><?=Lang::get('prods_by_cats')?></div>
        <ul class="listitem">
            <li><a <?=($cat['id'] == '' ? 'class="active"' : '')?>
                href="<?=str_replace('&cid=' . RequestWrapper::getValueSafe('cid'), '', $GLOBALS['url'])?><?=$tmall?>"><?=Lang::get('all_categories')?></a>
            </li>
            <?

            if ($_GET['p'] == 'category' || $_GET['p'] == 'search' || $_GET['p'] == 'item_list_ajax') {

                $cid = RequestWrapper::getValueSafe('cid');
                $hasHidden = false;
                foreach ($subcats as $k => $category) {
                    ?>
                    <?
                    if ($k < 10) {
                        $url = str_replace('&cid=' . RequestWrapper::getValueSafe('cid'), '', $GLOBALS['url']);
                        ?>
                        <li><a
                            href="<?=$url;?>&cid=<?=$category['id'];?><?=$tmall?>" <?=($category['id'] == $cid ? 'class="active"' : '')?>> <?=$category['name'];?> <? if ($category['itemcount']) { ?>
                            (<?= $category['itemcount'] ?>) <? } ?></a></li>
                        <?
                    } else {
                        $hasHidden = true;
                        ?>
                        <li class="left-category-hidden"><a <?=($category['id'] == $cid ? 'class="active"' : '')?>
                            href="<?=$GLOBALS['url'];?>&cid=<?=$category['id'];?><?=$tmall?>"> <?=$category['name'];?> <? if ($category['itemcount']) { ?>
                            (<?= $category['itemcount'] ?>) <? } ?></a></li>
                        <? } ?>
                    <? } ?>
                <? if ($hasHidden) { ?>
                    <li class="last"><a href="#" class="all dotted"
                                        onclick="$('.left-category-hidden').show();$(this).remove();return false;"><i
                        class="i arrowdown"></i><span><?=Lang::get('other_cats')?></span></a></li>
                    <? }
            }?>
            <?

            if ($_GET['p'] == 'subcategory') {

                $cid = RequestWrapper::getValueSafe('cid');
                $hasHidden = false;
                foreach ($GLOBALS['cats'] as $k => $cat) {
                    ?>
                    <? if ($k >= 10) {
                        $classLink = ' class="left-category-hidden"';
                    }
                    if ($cat['ishidden'] == 'false') {
                        ?>
                        <? if ($cat['isparent'] == 'false') { ?>
                            <li<?=$classLink?>><a
                                href="<?=General::generateUrl('category', array_merge(array('clear' => false), $cat))?><?=$tmall?>"><?=$cat['name']?></a>
                            </li>
                            <? } else { ?>
                            <li<?=$classLink?>><a
                                href="<?=General::generateUrl('subcategory', array_merge(array('clear' => false), $cat))?><?=$tmall?>"><?=$cat['name']?></a>
                            </li>
                            <? } ?>
                        <? } ?>
                    <? } ?>
                <? if ($k > 10) { ?>
                    <li class="last"><a href="#" class="all dotted"
                                        onclick="$('.left-category-hidden').show();$(this).remove();return false;"><i
                        class="i arrowdown"></i><span><?=Lang::get('other_cats')?></span></a></li>
                    <? }
            }?>
        </ul>
    </div>
    <? } ?>

    <div class="bgr-block mb20">
        <?=$SearchProp?>
    </div>
</div>

<div class="flr col690 bproduct">
    <? if (@$GLOBALS['brandinfo']) { ?>
    <!-- .panel-search -->    
    <div class="wrap clrfix" style="margin-bottom: 10px; width: 690px">
        <img src="<?=$GLOBALS['brandinfo']['PictureUrl']?>" style="float:left; margin: 0 10px 10px 0"/>
        <?=$GLOBALS['brandinfo']['Description']?>
    </div>
    <? } ?>
    <div class="bgr-panel mb20">

        <ul class="tableList">
            <li><?=Lang::get('items_rus')?>: <b><?=$totalcount?></b></li>
            <li><?=Lang::get('shown')?>: <?=Lang::get('from')?> <b><?=($from + 1)?></b> <?=Lang::get('to')?>
                <b><? if ($from + $perpage < $count) print $from + $perpage; else print $count; ?></b> <?=Lang::get('from2')?>
                <b><?=$count?></b></li>
            <li>
                <form method="post" id="sort_form">
                    <?=Lang::get('sort_by')?>
                    <select name="sort_by" onchange="document.getElementById('sort_form').submit();">
                        <option
                            value="popularity:desc" <?if ($_GET['sort_by'] == 'popularity:desc') { ?>selected<? }?>><?=Lang::get('popularity')?></option>
                        <option
                            value="price:desc" <?if ($_GET['sort_by'] == 'price:desc') { ?>selected<? }?>><?=Lang::get('price_desc')?></option>
                        <option
                            value="price:asc" <?if ($_GET['sort_by'] == 'price:asc') { ?>selected<? }?>><?=Lang::get('price_asc')?></option>
                        <!--option
                            value="vendorRating:desc" <?if ($_GET['sort_by'] == 'vendorRating:desc') { ?>selected<? }?>><?=Lang::get('vendor_rating')?></option>
                        <option
                            value="volume:desc" <?if ($_GET['sort_by'] == 'volume:desc') { ?>selected<? }?>><?=Lang::get('sales_volume')?></option-->
                    </select>
                </form>

            </li>
            <li>
                <form method="post" id="per_page">
                    <?=Lang::get('output_to')?>
                    <select name="per_page" onchange="document.getElementById('per_page').submit();">
                        <option value="16" <?if ($perpage == '16') { ?>selected<? }?>>16</option>
                        <option value="64" <?if ($perpage == '64') { ?>selected<? }?>>64</option>
                        <option value="128" <?if ($perpage == '128') { ?>selected<? }?>>128</option>
                    </select>
                </form>
            </li>
        </ul>
    </div>
    <!-- /.panel-search -->

    <? if (!empty($itemlist)) { ?>
    <!-- .product -->
    <ul class="lproduct flin w700 w160li clrfix">

        <? if (in_array('Seo2', General::$enabledFeatures)) {
        $url = 'item?';
    } else {
        $url = 'index.php?p=item&';
    } ?>
        <? if (!empty($itemlist)) foreach ($itemlist as $idx => $item) { ?>
        <li class="product" id="product<?=$idx?>" title="<?= $item['title'] ?>" style="position:relative;">           
            <a class="pic" href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>" title="<?=$item['VendorName']?>">
                <?if($item['mainpictureurl']){?>
                <i><img src="<?=$item['mainpictureurl']?>_160x160.jpg"></i>
                <ins></ins>
                <?}?>
            </a>

            <div class="price">
                <div class="line"></div>
                <a href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>"
                   title="<?=General::getCurrencyPrice($item)?>"><span><?=General::getCurrencyPrice($item)?></span></a>

                <? if ($item['vendorscore'] == 0) { ?>
                <? } elseif ($item['vendorscore'] < 8) { ?>
                <a href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>"><b class="green" title="<?=$item['vendorscore']?>"><i
                    class="i price_icon"></i><?=$item['vendorscore']?></b></a>
                <? } elseif ($item['vendorscore'] < 15) { ?>
                <a href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>"><b class="yellow" title="<?=$item['vendorscore']?>"><i
                    class="i price_icon"></i><?=$item['vendorscore']?></b></a>
                <? } else { ?>
                <a href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>"><b class="red" title="<?=$item['vendorscore']?>"><i
                    class="i price_icon"></i><?=$item['vendorscore']?></b></a>
                <? } ?>

                <a href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>" title="<?=$item['VendorName']?>">
                    <ins class="name" pid="<?=$item['id']?>"><?=$item['VendorName']?></ins>
                    <span class="glow"></span></a>
            </div>
            <?
            if (!defined('NO_DEBUG')) {
                print implode(', ', $item['Features']);
            }
            ?>
            <? if (count($item['PromotionPrice'])>0) { ?>
            	<div align="center" style="position:absolute; top:110px; left:70px; width:80px; height:40px; background-color:#C60; padding:5px;">
                	<span style="color:#CCC; font-size:12px; text-decoration:line-through;"><?=General::getCurrencyPrice($item)?></span><br>                
                	<span style="color:#FFF; font-size:14px;"><?=General::getCurrencyPromoPrice($item)?></span>
                </div>
            <? } ?>   
        </li>
        <?
        if ($idx % 4 == 3) {
            ?>
            <div style="clear: both"></div>
            <?
        }
        ?>
        <? } ?>
    </ul>
    <!-- /.product -->
    <? } else { ?>
    <h2><?=Lang::get('nothing_found')?></h2>
    <? } ?>

    <!-- .pager -->
    <div>
        <? $page_count_print = (isset(General::$siteConf['pager_count_print'])) ? General::$siteConf['pager_count_print'] : '2'; ?>
        <? $curpage = floor($from / $perpage) + 1 ?>
        <? $maxpage = ceil($count / $perpage) ?>
        <? if ($curpage != 1) {?>
        <a href="<?=$pageurl?>&from=<?=$from - $perpage?>&tmall=<?=$tmall?>"
           class="fll btn-apper border_radius_left"><span><?=Lang::get('prev_page')?></span></a>
        <? } ?>

        <ul class="flin pager clrfix">
            <? if ($curpage > ($page_count_print + 1)) { ?>
            <li><a href="<?=$pageurl?>&from=0&tmall=<?=$tmall?>">1</a></li>
            <? } ?>
            <? if ($curpage > ($page_count_print + 2)) { ?>
            <li>...</li>
            <? } ?>
            <? for ($i = max(1, $curpage - $page_count_print); $i <= min($maxpage, $curpage + $page_count_print); $i++) { ?>
            <? if ($curpage == $i) { ?>
                <li class="active"><a href="<?=$pageurl?>&from=<?=(($i - 1) * $perpage)?>&tmall=<?=$tmall?>"><?=$i?></a>
                </li>
                <? } else { ?>
                <li><a href="<?=$pageurl?>&from=<?=(($i - 1) * $perpage)?>&tmall=<?=$tmall?>"><?=$i?></a></li>
                <? } ?>
            <? } ?>
            <? if ($curpage < $maxpage - ($page_count_print + 1)) { ?>
            <li><span>...</span></li>
            <? } ?>
            <? if ($curpage < $maxpage - $page_count_print) { ?>
            <li><a href="<?=$pageurl?>&from=<?=(($maxpage - 1) * $perpage)?>&tmall=<?=$tmall?>"><?=$maxpage?></a></li>
            <? } ?>
        </ul>

        <? if ($maxpage > 1 && !($curpage >= $maxpage)) { ?>
        <a href="<?=$pageurl?>&from=<?=$from + $perpage?>&tmall=<?=$tmall?>"
           class="btn fll btn-apper border_radius_right"><span><?=Lang::get('next_page')?></span></a>
        <? } elseif ($curpage > $maxpage) { ?>
        <? } ?>
    </div>
    <!-- /.pager -->

</div>
</div>
</div>
</div>
<!-- /.main -->
<? if (isset ($_COOKIE['ftitle'])&&$_COOKIE['ftitle']=='closed'):?>
<script>
    $(function(){
        $('.ftitle').click();
    });
</script>
<?endif;?>