<?=Plugins::invokeEvent('onItemListRenderStatistics', array('categoryName' => $this->escape($GLOBALS['categoryInfo']['Name'])))?>

<script type="text/javascript">
	$(document).ready(
		function(){
			$(".w160li li").hover(
				function(){
					$(this).css('box-shadow','7px 2px 5px 0 rgba(0, 0, 0, 0.50)');
				},
				function(){
					$(this).css('box-shadow','none');
				}
			);
		}
	);
</script>
<style type="text/css">
.w160li li {
	width: 215px;
	margin: 0 0 18px 18px;
}
.w160i li:hover{
	box-shadow:1px 1px 2px 0 rgba(0, 0, 0, 0.2);
}
.w160li .pic {
    height: 220px;
}
.w160li .pic i {
	width: 215px;
	height:220px;
	display:block;
	position:relative;
}
.w160li .pic i .discount{
	position: absolute;
    right: -13px;
    top: -3px;
    z-index: 2;
	background:url("/skidka_red.png") no-repeat;
	
	font-family:"Trebuchet MS","Helvetica CY",sans-serif;
	color: #FFFFFF;
    font-size: 25px;
    height: 53px;
    text-shadow: 1px 1px 1px #750C91;
    width: 65px;
	padding-top:20px;
}

.w160li .pic ins {
	display:none;
}

.wrapper_sale_item {
	top: 197px;
	left:90px;
	height:14px;
	font-weight:bold;
}
.wrapper_sale_item .old_price {
	font-size:15px;
	position:relative;
	top:-3px;	
}
  
/* h1 */
.wrap.clrfix h1{
	margin-bottom: 2px;
    margin-top: -17px;
}   
</style>

<script type="text/javascript">
    var overid = 0;
    langs = {
        vendor_added_to_favourites: '<?=Lang::get('vendor_added_to_favourites')?>'
    };





    function gettitle(lid) {
        if (lid != overid) return;
        var obj = $('#' + lid + ' ins.name');

        $.ajax({
            url:'index.php?p=itemtitle&itemid=' + obj.attr('pid'),
            success:function (data) {
                if (data && data.toString().length) {
                    obj.html(data);
                    obj.parent().attr('title', data);
                    obj.closest('li').find('.pic').attr('title', data);
                }
            },
            error:function (jqXHR, textStatus, errorThrown) {
                obj.html('');
            }
        });
    }

    $(function () {

        $('.product').mouseover(function () {
            if (overid != $(this).attr('id')) {
                overid = $(this).attr('id');
                setTimeout('gettitle("' + overid + '")', 1000);
            }
        });
        $('.product').mouseout(function () {
            overid = 0;
        });

        $("#dialog-form").dialog({
        autoOpen: false,
        modal: true,
        buttons : {
            "Ок" : function() {
                $("#dialog-form").dialog("close");
            }
        }
    });

    });

    function showOverlay(){
        var h = $('#overlay').parent().height();
        $('#overlay').css({
            height: h+'px',
            display: 'block'
        });
    }
    function hideOverlay(){
        $('#overlay').hide();
    }
</script>


<!-- raiting -->
<script type="text/javascript">
	$(document).ready(
		function(){
			
			$(".show_rating").click(
				function(){
						$.colorbox({
								inline:true,
								html: true,
								width:'70%',
								maxWidth:'750px',
								height:'615px',
								maxHeight:'615px',
								open:false,
								returnFocus:false,
								fixed: true,
								title: false,
								href:'.about_rating',
								opacity:'0.7',
								fixed:true
						});	
						return false;			
				}
			);
			
		}
	);
</script>
<div style="display:none">
<div id="content_area" class="about_rating">
	<h1>Рейтинг продавца</h1>
    <p><span style="font-family: arial,helvetica,sans-serif; font-size: small;">Формирование рейтинга продавца - <strong>важный показатель</strong>, помогающий определить, <strong>степень надежности продавца.</strong> <strong>Расчет рейтинга происходит исходя из количества успешных сделок.</strong> Высокий рейтинг продавца также говорит и о качестве предлагаемой им продукции, точности ее описания, отсутствии задержек при поставке товара. Для того, чтобы Вы могли быть уверены в качестве приобретаемых товаров, мы рекомендуем выбирать продавцов с высоким рейтингом, а также продавцов с рейтингом <img alt="" src="/i/hearts_gif/level_21_tmall.gif">.</span></p>
    <p><span style="font-family: arial,helvetica,sans-serif; font-size: small;"><strong>Логотип Tmall означает, что продавцом выступает официальный представитель, напрямую работающий с производителями.</strong> Все продавцы Tmall, а также представляемые ими товары, проходят тщательную проверку, что гарантирует высокое качество продукции.</span></p>
    <p>&nbsp;</p>
    <table border="0" rules="all" frame="void" style="width: 100%;">
    <tbody>
    <tr><th>Низкий рейтинг</th><th>Количество сделок</th><th>Средний рейтинг</th><th>Количество сделок</th></tr>
    <tr>
    <td><img alt="" src="/i/hearts_gif/level_1.gif"></td>
    <td>от 4 до 10</td>
    <td><img alt="" src="/i/hearts_gif/level_6.gif"></td>
    <td>от 251 до 500</td>
    </tr>
    <tr>
    <td><img alt="" src="/i/hearts_gif/level_2.gif"></td>
    <td>от 11 до 40</td>
    <td><img alt="" src="/i/hearts_gif/level_7.gif"></td>
    <td>от 501 до 1 тыс.</td>
    </tr>
    <tr>
    <td><img alt="" src="/i/hearts_gif/level_3.gif"></td>
    <td>от 41 до 90</td>
    <td><img alt="" src="/i/hearts_gif/level_8.gif"></td>
    <td>от 1 до 2 тыс.</td>
    </tr>
    <tr>
    <td><img alt="" src="/i/hearts_gif/level_4.gif"></td>
    <td>от 91 до 150</td>
    <td><img alt="" src="/i/hearts_gif/level_9.gif"></td>
    <td>от 2 до 5 тыс.</td>
    </tr>
    <tr>
    <td><img alt="" src="/i/hearts_gif/level_5.gif"></td>
    <td>от 151 до 250</td>
    <td><img alt="" src="/i/hearts_gif/level_10.gif"></td>
    <td>от 5 до 10 тыс.</td>
    </tr>
    <tr><th>Высокий рейтинг</th><th>Количество сделок</th><th>Очень высокий рейтинг</th><th>Количество сделок</th></tr>
    <tr>
    <td><img alt="" src="/i/hearts_gif/level_11.gif"></td>
    <td>от 10 до 20 тыс.</td>
    <td><img alt="" src="/i/hearts_gif/level_16.gif"></td>
    <td>от 500 тыс. до 1 млн.</td>
    </tr>
    <tr>
    <td><img alt="" src="/i/hearts_gif/level_12.gif"></td>
    <td>от 20 до 50 тыс.</td>
    <td><img alt="" src="/i/hearts_gif/level_17.gif"></td>
    <td>от 1 до 2 млн.</td>
    </tr>
    <tr>
    <td><img alt="" src="/i/hearts_gif/level_13.gif"></td>
    <td>от 50 до 100 тыс.</td>
    <td><img alt="" src="/i/hearts_gif/level_18.gif"></td>
    <td>от 2 до 5 млн.</td>
    </tr>
    <tr>
    <td><img alt="" src="/i/hearts_gif/level_14.gif"></td>
    <td>от 100 до 200 тыс.</td>
    <td><img alt="" src="/i/hearts_gif/level_19.gif"></td>
    <td>от 5 до 10 млн.</td>
    </tr>
    <tr>
    <td><img alt="" src="/i/hearts_gif/level_15.gif"></td>
    <td>от 200 до 500 тыс.</td>
    <td><img alt="" src="/i/hearts_gif/level_20.gif"></td>
    <td>свыше 10 млн.</td>
    </tr>
    </tbody>
    </table>
    <p>&nbsp;</p>
    <p><strong><span style="font-family: arial,helvetica,sans-serif; font-size: small;">Надеемся, информация оказалась полезной. Приятных покупок !</span></strong></p>
</div>
</div>
<!-- /rating -->


<!-- Вставили  -->
<div id="dialog-form" title="<?=Lang::get('message')?>">
    <span id="basketinfo"></span>
</div>


<? if (isset($hintcats) && count($hintcats) > 0) { ?>
<div class="samecat">
    <div class="wrap clrfix">
        <div class="bproduct">
            <h2 class="mb20"><span><?=Lang::get('suitable_category')?></span></h2>
            <ul class="lcategory clrfix flin">
                <?
                $cid = RequestWrapper::getValueSafe('cid');
                $hasHidden = false;
                ?>
                <? foreach ($hintcats as $k => $category) { ?>
                <? if ($k < 10) { ?>
                    <li <?=($cat['id'] == $cid ? 'class="active"' : '')?>><a
                        href="<?=General::generateUrl('subcategory', $category)?>"
                        > <?=$this->escape($category['name']);?></a></li>
                    <?
                } else {
                    $hasHidden = true;
                    ?>
                    <li class="fast-category-hidden"><a
                        href="index.php?p=category&cid=<?=$category['id'];?>"> <?=$this->escape($category['name']);?></a></li>
                    <? } ?>
                <? } ?>
                <? if ($hasHidden) { ?>
                    <li class="last"><a href="#" class="all dotted" onclick="$('.fast-category-hidden').show();$(this).remove();return false;"><i class="i arrowdown"></i><span>Еще категории</span></a></li>
                <? } ?>
            </ul>
        </div>
    </div>
</div>
<? } ?>

<!-- .main -->
<div class="main">
<div class="wrap clrfix">
<div class="bproduct">

<? if (!$no_search_request) { ?>

<h2 class="mb25"><span><?=Lang::get('founded_goods')?></span></h2>

<div class="fll col240">
<div id="overlay"></div>
    <? if ($vendorInfo) { ?>
    <div class="bgr-block mb20">
        <table class="info f11">
            <tbody>
            <? if(!General::getConfigValue('hide_vendor_info_name')) { ?>
            <tr>
                <td><?=Lang::get('name')?>:</td>
                <td><b><?=$this->escape($vendorInfo['name'])?></b></td>
            </tr>
            <? } ?>
            <tr>
                <td><?=Lang::get('placed_in')?>:</td>
                <td><b><?=$vendorInfo['location']['city']?> (<?=$vendorInfo['location']['state']?>)</b></td>
            </tr>

            <tr>
                <td><?=Lang::get('features')?>:</td>
                <td><b><?=$vendorInfo['location']['city']?></b></td>
            </tr>

            <tr>
                <td><?=Lang::get('responses')?>:</td>
                <td><b><?=$vendorInfo['credit']['TotalFeedbacks']?></b></td>
            </tr>
            <tr>
                <td><?=Lang::get('positive')?>:</td>
                <td><b><?=$vendorInfo['credit']['PositiveFeedbacks']?></b></td>
            </tr>
            <? if ($vendorInfo['credit']['level']) { ?>
            <tr>
                <td><?=Lang::get('rating')?>:</td>
                <td>
                    <a href="#" class="raiting raiting__description-product">
                        <i class="i-raiting raiting_<?=$vendorInfo['credit']['level']?>"></i>
                    </a>
                </td>
            </tr>
            <? } ?>
            <tr>
                <td colspan="2" style="text-align: right">
                    <a href="#" id="add-vendor-to-favourites" vendorid="<?=$this->escape($vendorInfo['name']) ?>" class="btn-small btn-add fll">
                        <span><?=Lang::get('add_vendor_to_favourites')?></span>
                    </a>
                </td>
            </tr>
        </table>

    </div>
    <? } ?>
    <? if (!RequestWrapper::getValueSafe('search')) { ?>
    <div class="bgr-block mb20" id="active-search-prop">
        <div class="titlecat"><?=Lang::get('active_cond')?></div>
        <ul class="listitem" id="clear-filter">
            <?if(RequestWrapper::getValueSafe('cid')){?>
            <li>
                <? if (! empty($prevCategoryLink)) { ?>
                    <a href="<?=$prevCategoryLink?>" class="i delete go"></a>
                <? } ?>
                <div class="cat"> <?=Lang::get('category')?> </div>
                <div class="itemcat"><?=$this->escape($GLOBALS['categoryInfo']['Name'])?></div>
            </li>
            <?}?>
            <li class="dropterms clrfix">
                <a href="<?=$clearUrl?>"
                   class="btn-small btn-delete fll"><span><?=Lang::get('reset_cond')?></span></a>
            </li>
        </ul>
    </div>
    <? } ?>

    <?php
    /**
     * @var UrlWrapper $baseUrl
     * @var string $CurrentSearchType
     * @var bool $IsProvider
     * @var array $itemlistMulti
     */
    $pageUrl = clone $baseUrl;
    $allSearchTypes = isset($SearchTypes) && is_array($SearchTypes) ? $SearchTypes : array();
    $activeSearchTypes = array();
    $isMultiSearch = General::getConfigValue('use_multi_search') && $CurrentSearchType != 'Warehouse_Default';
    if($isMultiSearch) {
        $activeSearchTypes[] = array(
            'url' => $pageUrl->DeleteKey('Provider')->DeleteKey('SearchMethod')->DeleteKey('discounts')->Get(),
            'title' => Lang::get('multisearch'),
            'active' => !($IsProvider == 'active'),
            'totalCount' => false,
            'offset' => 0
        );
    }
    foreach($allSearchTypes as $order => $searchType) {
        $searchTypeInfo = isset($itemlistMulti[$searchType['Provider'].'_'.$searchType['SearchMethod']]) ?
            $itemlistMulti[$searchType['Provider'].'_'.$searchType['SearchMethod']] : false;
        $newSearchType = array(
            'url' => $pageUrl->DeleteKey('discounts')->DeleteKey('Provider')->DeleteKey('SearchMethod')
                ->Add('Provider', $searchType['Provider'])->Add('SearchMethod', $searchType['SearchMethod'])->Get(),
            'title' => Lang::get($searchType['Provider'].'_'.$searchType['SearchMethod'].'_Flag'),
            'active' => (($CurrentSearchType == $searchType['Provider'].'_'.$searchType['SearchMethod'])
                        && !RequestWrapper::getValueSafe('discounts'))
                        || ($order == 0 && !$isMultiSearch && !$CurrentSearchType),
            'totalCount' => $searchTypeInfo ? $searchTypeInfo['totalcount'] : false,
            'offset' => 0
        );
        if(($newSearchType['totalCount'] === false && $searchType['Provider'].'_'.$searchType['SearchMethod'] != 'Warehouse_Default')
            || $newSearchType['totalCount'] > 0) {
            $activeSearchTypes[] = $newSearchType;
        }
        if ($searchType['Provider'] == 'China' && $searchType['SearchMethod'] == 'Official') {
            $activeSearchTypes[] = array(
                'url' => $pageUrl->Add('discounts', 'true')->Get(),
                'title' => '> ' . Lang::get('China_Official_Discount_Flag'),
                'active' => RequestWrapper::getValueSafe('discounts'),
                'totalCount' => false,
                'offset' => 1
            );
        }
    }
    ?>

    <? if(count($activeSearchTypes) > 1){ ?>
    <div class="bgr-block mb20">
        <div class="titlecat"><?=Lang::get('supplier_type')?></div>      

        <ul class="listitem">
            <?php foreach($activeSearchTypes as $type) { ?>
                <li style="margin-left: <?=$type['offset']*15?>px;">
                    <a class="<?=$type['active'] ? 'active' : ''?>" href="<?=$type['url']?>">
                        <?=$type['title']?>
                        <?php if ($type['totalCount'] !== false) { ?>
                            (<span style="font-size:10px;">
                                <?=$type['totalCount']?>
                            </span>)
                        <?php } ?>
                    </a>
                </li>
            <?php } ?>
        </ul>
    </div>
    <? } ?>

    <? if (isset($subCategories) && is_array($subCategories) && count($subCategories)) { ?>
    <div class="bgr-block mb20">
        <div class="titlecat"><?=Lang::get('prods_by_cats')?></div>
        <ul class="listitem">
            <li><a <?=(!isset($cid) || $cid == '' ? 'class="active"' : '')?>
                href="<?=$baseUrl->DeleteKey('Provider')->DeleteKey('SearchMethod')->DeleteKey('cid')->Get()?>"><?=Lang::get('all_categories')?></a>
            </li>
            <?

            if (SCRIPT_NAME == 'search' || SCRIPT_NAME == 'item_list_ajax') {

                $cid = RequestWrapper::getValueSafe('cid');
                $hasHidden = false;
                foreach ($subCategories as $k => $category) {
                    ?>
                    <?
                    if ($k < 10) {
                    if (RequestWrapper::getValueSafe('Provider')) {
                        $url = $baseUrl->DeleteKey('cid')->Add('Provider', RequestWrapper::getValueSafe('Provider'))->Add('SearchMethod', RequestWrapper::getValueSafe('SearchMethod'))->Get();
                    } else {
                        $url = $baseUrl->DeleteKey('Provider')->DeleteKey('SearchMethod')->DeleteKey('cid')->Get();
                    }
                        ?>
                        <li><a
                            href="<?=UrlGenerator::generateFullSearchUrl($url,$category['id'],$tmall,RequestWrapper::getValueSafe('discounts')); ?>" <?=($category['id'] == $cid ? 'class="active"' : '')?>> <?=$this->escape($category['name']);?> <? if ($category['itemcount']) { ?>
                            (<?= $category['itemcount'] ?>) <? } ?></a></li>
                        <?
                    } else {
                        $hasHidden = true;
                        ?>
                        <li class="left-category-hidden"><a <?=($category['id'] == $cid ? 'class="active"' : '')?>
                            href="<?=UrlGenerator::generateFullSearchUrl($url,$category['id'],$tmall,RequestWrapper::getValueSafe('discounts')); ?>"> <?=$this->escape($category['name']);?> <? if ($category['itemcount']) { ?>
                            (<?= $category['itemcount'] ?>) <? } ?></a></li>
                        <? } ?>
                    <? } ?>
                <? if ($hasHidden) { ?>
                    <li class="last"><a href="#" class="all dotted"
                                        onclick="$('.left-category-hidden').show();$(this).remove();return false;"><i
                        class="i arrowdown"></i><span><?=Lang::get('other_cats')?></span></a></li>
                    <? }
            }?>
            <?

            if (SCRIPT_NAME == 'subcategory' || SCRIPT_NAME == 'category') {

                $hasHidden = false;
                foreach ($subCategories as $k => $cat) {
                    ?>
                    <? if ($k >= 10) {
                        $classLink = ' class="left-category-hidden"';
                    }
                    if (RequestWrapper::getValueSafe('Provider')) {
                        $cat['Provider'] = RequestWrapper::getValueSafe('Provider');
                        $cat['SearchMethod']= RequestWrapper::getValueSafe('SearchMethod');
                    }
                    if (!isset($cat['ishidden']) || $cat['ishidden'] == 'false') {
                        ?>
                        <? if (!isset($cat['isparent']) || $cat['isparent'] == 'false') { ?>
                            <li<?=$classLink?>><a
                                href="<?=UrlGenerator::generateFullCatUrl('category',$cat,$tmall,RequestWrapper::getValueSafe('discounts'))?>"><?=$this->escape($cat['name'])?></a>
                            </li>
                            <? } else { ?>
                            <li<?=$classLink?>><a
                                href="<?=UrlGenerator::generateFullCatUrl('subcategory',$cat,$tmall,RequestWrapper::getValueSafe('discounts'))?>"><?=$this->escape($cat['name'])?></a>
                            </li>
                            <? } ?>
                        <? } ?>
                    <? } ?>
                <? if ($k > 10) { ?>
                    <li class="last"><a href="#" class="all dotted"
                                        onclick="$('.left-category-hidden').show();$(this).remove();return false;"><i
                        class="i arrowdown"></i><span><?=Lang::get('other_cats')?></span></a></li>
                    <? }
            }?>
        </ul>
    </div>
    <? } ?>

    <div class="bgr-block mb20">
        <?=$SearchProp?>
    </div>
</div>

<div class="flr col690 bproduct">
    <? if (@$GLOBALS['brandinfo']) { ?>
    <!-- .panel-search -->
    <div class="wrap clrfix" style="margin-bottom: 10px; width: 690px">
        <img src="<?=$GLOBALS['brandinfo']['PictureUrl']?>" style="float:left; margin: 0 10px 10px 0"/>
        <?=$GLOBALS['brandinfo']['Description']?>
    </div>
    <? } ?>
    <div class="bgr-panel mb20">

        <ul class="tableList">
        	<? if ($IsProvider) { ?>

            <li><?=Lang::get('items_rus')?>: <b><?=$totalcount?></b></li>
            <li><?=Lang::get('shown')?>: <?=Lang::get('from')?> <b><?=($count ? $from + 1 : 0)?></b> <?=Lang::get('to')?>
                <b><? if ($from + $perpage < $count) print $from + $perpage; else print $count; ?></b>               
                    <?=Lang::get('from2')?>
                    <b><?=$count?></b>
              
            </li>
            <? } ?>
            <li <?=!$IsProvider? 'style="text-align: right;"':''?> >
                <form method="post" id="sort_form">
                    <?=Lang::get('sort_by')?>
                    <select name="sort_by" onchange="document.getElementById('sort_form').submit();">
                        <option
                            value="popularity:desc" <?if ($_GET['sort_by'] == 'popularity:desc') { ?>selected<? }?>><?=Lang::get('popularity')?></option>
                        <option
                            value="price:desc" <?if ($_GET['sort_by'] == 'price:desc') { ?>selected<? }?>><?=Lang::get('price_desc')?></option>
                        <option
                            value="price:asc" <?if ($_GET['sort_by'] == 'price:asc') { ?>selected<? }?>><?=Lang::get('price_asc')?></option>
                        <!--option
                            value="vendorRating:desc" <?if ($_GET['sort_by'] == 'vendorRating:desc') { ?>selected<? }?>><?=Lang::get('vendor_rating')?></option>
                        <option
                            value="volume:desc" <?if ($_GET['sort_by'] == 'volume:desc') { ?>selected<? }?>><?=Lang::get('sales_volume')?></option-->
                    </select>
                </form>

            </li>
            <? if ($IsProvider) { ?>
            <li>
                <form method="post" id="per_page">
                    <?=Lang::get('output_to')?>
                    <select name="per_page" onchange="document.getElementById('per_page').submit();">
                        <option value="20" <?if ($perpage == '20') { ?>selected<? }?>>20</option>
                        <option value="40" <?if ($perpage == '40') { ?>selected<? }?>>40</option> 
                        <option value="100" <?if ($perpage == '100') { ?>selected<? }?>>100</option> 
                        
                    </select>
                </form>
            </li>
            <? } ?>
        </ul>
    </div>
    <!-- /.panel-search -->

    <? if (!empty($itemlist)) { ?>
    <!-- .product -->
    <? 
    	$count_1 = count($itemlist);
    	$max_items = floor($count_1/3);
        $new_itemlist = array_chunk($itemlist,$max_items*3);
        $new_itemlist = $new_itemlist[0];
    ?>

    <ul class="lproduct flin w700 w160li clrfix">

        <? if (in_array('Seo2', General::$enabledFeatures)) {
        $url = 'item?';
        } else {
            $url = 'index.php?p=item&';
        } ?>
        <? if (!empty($itemlist)) foreach ($new_itemlist as $idx => $item) { ?>
            <? if($item['ErrorCode'] == 'Ok') { ?>
            <li class="product" id="product<?=$idx?>" title="<?=$this->escape($item['title'])?>" style="position:relative;">
                <a class="pic" href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>" title="">
                    <?if (! empty($item['mainpictureurl'])) { ?>
                    <i>
                    	<img src="<?= ProductsHelper::getImage($item, 220) ?>">
                    	<? if ((count($item['PromotionPrice'])>0) and (!General::getConfigValue('hide_discont_lists'))) { 
                            $old_price = $item['Price']['ConvertedPriceList'][0]['Val'];
                            $new_price = $item['PromotionPrice'][0]['Val'];
                            $discount = floor((($old_price - $new_price)/$old_price)*100);
                            
                            if ($discount){
                        ?>
                            <div class="discount">
                                -<? echo $discount; ?>%
                            </div>
                        <? 	}
                         } ?>
                    </i>
                    <ins></ins>
                    <?}?>
                </a>

                <div class="price">
                    <div class="line"></div>
                    <a href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>">
                        <? if ((count($item['PromotionPrice'])>0) and (!General::getConfigValue('hide_discont_lists'))) { ?>
                            <span><?=General::getCurrencyPromoPrice($item)?></span>
                        <? }else{ ?>
                            <span><?=General::getCurrencyPrice($item)?></span>
                        <? } ?>
                    </a>

                    <a href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>" class="show_rating">
                        <ins class="nam" pid="<?=$item['id']?>">
                        	<? //$this->escape($item['VendorName'])?>
                            <em class="raiting" style="background-color:blue;">
                    			<i class="i-raiting raiting_<?=$item['vendorscore']?>">рейтинг</i>
                			</em>
                        </ins>
                        <span class="glow"></span></a>
                </div>
                <?
                if (!defined('NO_DEBUG')) {
                    print implode(', ', $item['Features']);
                }
                ?>
                <? if ((count($item['PromotionPrice'])>0) and (!General::getConfigValue('hide_discont_lists'))) { ?>
                    <div align="center" class="wrapper_sale_item">
                    	<span class="old_price"><?=General::getCurrencyPrice($item)?></span>
                	</div>
                <? } ?>
            </li>
            <? } else { ?>
                <?=View::fetchTemplate('item-error-code', 'item', '/blocks/search/', array('item' => $item))?>
            <? } ?>
            <? // if ($idx % 4 == 3) { ?>
            <? if (($idx+1) % 3 == 0) { ?>
                <div style="clear: both"></div>
            <? } ?>
        <? } ?>
    </ul>
    <!-- /.product -->
    <? } else if (!empty($itemlistMulti) && !RequestWrapper::getParamExists('SearchMethod')) { ?>
    <!-- .product -->
            <? if (in_array('Seo2', General::$enabledFeatures)) {
                $url = 'item?';
            } else {
                $url = 'index.php?p=item&';
            } ?>



    <? foreach ($itemlistMulti as $key=>$list) {
       $key = $key=='Taobao_Extended'?'China_Other':$key;

        ?>
    <? if (count($list['Items'])) { ?>
    <?
    $SType = explode("_", $key);
    ?>
    <div class="multi">
    	<div class="top_line">         
        
        	<div class="top_left"> 
        		<?=Lang::get($key.'_Flag')?>
                <?if(isset($list['totalcount'])){?>
                    <span class="totalcount"><?=$list['totalcount']?> <?=Lang::get('items_rus')?></span>
                <?}?>
            </div>
            <div class="top_right">
                <?
                $viewAllUrl = $baseUrl->Add('Provider', $SType[0])->Add('SearchMethod', $SType[1]);
                if(RequestWrapper::getValueSafe('cid'))
                    $viewAllUrl->Add('cid', RequestWrapper::getValueSafe('cid'));
                ?>
                <a href="<?=$viewAllUrl->Get()?>" style="color:#FFF"> <?=Lang::get('multi_see_all')?> > </a>
             </div>
             <div style="clear:both"></div>
        </div>

        <div class="item_block">
            <ul class="lproduct flin w700 w160li clrfix">
            
<?
    	$count_2 = count($list['Items']);
    	$max_items = floor($count_2/3);
        $new_list = array_chunk($list['Items'],$max_items*3);
        $new_list = $new_list[0];
?>

                <? //foreach ($list['Items'] as $idx => $item) { ?>
                <? foreach ($new_list as $idx => $item) { ?>
                    <? if($item['ErrorCode'] == 'Ok') { ?>
                    <li class="product" id="product<?=$key?><?=$idx?>" title="<?=$this->escape($item['title'])?>" style="position:relative;">
                        <a class="pic" href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>" title="">
                            <?if (! empty($item['mainpictureurl'])) { ?>
                            <i>
                            	<img src="<?= ProductsHelper::getImage($item, 220) ?>">
                                <? if ((count($item['PromotionPrice'])>0) and (!General::getConfigValue('hide_discont_lists'))) { 
                                    $old_price = $item['Price']['ConvertedPriceList'][0]['Val'];
                                    $new_price = $item['PromotionPrice'][0]['Val'];
                                    $discount = floor((($old_price - $new_price)/$old_price)*100);
                                    
                                    if ($discount){
                                ?>
                                    <div class="discount">
                                        -<? echo $discount; ?>%
                                    </div>
                                <? 	}
                                 } ?>
                            </i>
                            <ins></ins>
                            <?}?>
                        </a>

                        <div class="price">
                            <div class="line"></div>
                            <a href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>">
                                <? if ((count($item['PromotionPrice'])>0) and (!General::getConfigValue('hide_discont_lists'))) { ?>
                                    <span><?=General::getCurrencyPromoPrice($item)?></span>
                                <? }else{ ?>
                                    <span><?=General::getCurrencyPrice($item)?></span>
                                <? } ?>
                            </a>


                            <!--noindex--><a href="<?=$url?>id=<?=$item['id']?>&vendorId=<?=$item['VendorId']?>" class="show_rating">
                                <ins class="nam" pid="<?=$item['id']?>">
                                	<? //$this->escape($item['VendorName'])?>
                                    <em class="raiting">
                                        <i class="i-raiting raiting_<?=$item['vendorscore']?>">рейтинг</i>
                                    </em>                                </ins>
                                <span class="glow"></span></a><!--/noindex-->
                        </div>
                        <?
                        if (!defined('NO_DEBUG')) {
                            print implode(', ', $item['Features']);
                        }
                        ?>
                        <? if ((count($item['PromotionPrice'])>0) and (!General::getConfigValue('hide_discont_lists'))) { ?>
                            <div align="center" class="wrapper_sale_item">
                                <span class="old_price"><?=General::getCurrencyPrice($item)?></span>
                            </div>
                        <? } ?>
                    </li>
                    <? } else { ?>
                        <?=View::fetchTemplate('item-error-code', 'item', '/blocks/search/', array('item' => $item))?>
                    <? } ?>
                    <? // if ($idx % 4 == 3) { ?>
                    <? if (($idx+1) % 3 == 0) { ?>
                        <div style="clear: both"></div>
                    <? } ?>
                <? } ?>
            </ul>
        </div>
    </div>
    <? } ?>
    <? } ?>


    <? } else { ?>
            <h2><?=Lang::get('nothing_found')?></h2>
    <? } ?>

    <? if(Session::checkErrors()){ ?>
            <?
            $errorCode = Session::getErrorCode();
            $errorDescription = Session::getErrorDescription();
            ?>
            <? if(Lang::get('Search:'.$errorCode) == 'Search:'.$errorCode){ ?>
                <h2><?=$errorCode?></h2>
                <strong><?=$errorDescription?></strong>
            <? }else{ ?>
                <h2><?=Lang::get('Search:'.$errorCode)?></h2>
            <? } ?>
     <? } ?>
  


    <!-- .pager -->
    <div>
    	<?
            $showPagination = true;
            $cid = RequestWrapper::getValueSafe('cid');
            if($cid)
               $baseUrl->Add('cid', $cid);
            $baseUrl->DeleteKey('Provider')->DeleteKey('SearchMethod');
            if (RequestWrapper::getValueSafe('Provider'))
           	   $baseUrl->Add('Provider', RequestWrapper::getValueSafe('Provider'))->Add('SearchMethod', RequestWrapper::getValueSafe('SearchMethod'));
			if (RequestWrapper::getValueSafe('discounts'))
               $baseUrl->Add('discounts', 'true');
        ?>
        <? $page_count_print = General::getConfigValue('pager_count_print') ? General::getConfigValue('pager_count_print') : '2'; ?>
        <? $curpage = floor($from / $perpage) + 1 ?>
        <?
        if (isset($lastSearchProvider) && $lastSearchProvider['totalCount'] >= 20 && $lastSearchProvider['totalCount'] >= 20) {
            $maxpage = ceil($lastSearchProvider['totalCount'] / $perpage) > 40 ? 40 : ceil($lastSearchProvider['totalCount'] / $perpage);
            $baseUrl->DeleteKey('Provider')->DeleteKey('SearchMethod');
            $lastProvider = explode("_", $lastSearchProvider['key']);
            $baseUrl->Add('Provider', $lastProvider[0])->Add('SearchMethod', $lastProvider[1]);
        } elseif (isset($lastSearchProvider) && ($lastSearchProvider['totalCount'] < 20 || $lastSearchProvider['totalCount'] < 20)) {
            $showPagination = false;
        } else {
            $maxpage = ceil($count / $perpage) > 40 ? 40 : ceil($count / $perpage);
        }

        ?>
        <? if ($curpage != 1) {?>
        <a href="<?=$baseUrl->DeleteKey('from')->Add('from',$from - $perpage)->Get()?>"
           class="fll btn-apper border_radius_left"><span><?=Lang::get('prev_page')?></span></a>
        <? } ?>

        <ul class="flin pager clrfix">
            <? if ($curpage > ($page_count_print + 1)) { ?>
            <li><a href="<?=$baseUrl->DeleteKey('from')->Add('from',0)->Get()?>">1</a></li>
            <? } ?>
            <? if ($curpage > ($page_count_print + 2)) { ?>
            <li>...</li>
            <? } ?>
            <? for ($i = max(1, $curpage - $page_count_print); $i <= min($maxpage, $curpage + $page_count_print); $i++) { ?>
            <? if ($curpage == $i) { ?>
                <li class="active"><a href="<?=$baseUrl->DeleteKey('from')->Add('from',($i - 1) * $perpage)->Get()?>"><?=$i?></a>
                </li>
                <? } else { ?>
                <li><a href="<?=$baseUrl->DeleteKey('from')->Add('from',($i - 1) * $perpage)->Get()?>"><?=$i?></a></li>
                <? } ?>
            <? } ?>
            <? if ($curpage < $maxpage - ($page_count_print + 1)) { ?>
            <li><span>...</span></li>
            <? } ?>
            <? if ($curpage < $maxpage - $page_count_print) { ?>
            <li><a href="<?=$baseUrl->DeleteKey('from')->Add('from',($maxpage - 1) * $perpage)->Get()?>"><?=$maxpage?></a></li>
            <? } ?>
        </ul>

        <? if ($maxpage > 1 && !($curpage >= $maxpage)) { ?>
        <a href="<?=$baseUrl->DeleteKey('from')->Add('from',$from + $perpage)->Get()?>"
           class="btn fll btn-apper border_radius_right"><span><?=Lang::get('next_page')?></span></a>
        <? } elseif ($curpage > $maxpage) { ?>
        <? } ?>
    </div>
    <!-- /.pager -->

</div>

<? } else { ?>
<h2><?=Lang::get('empty_search')?></h2>
<?} ?>



</div>
</div>
</div>
<!-- /.main -->
<?=Plugins::invokeEvent('onItemListCustom')?>
<? if (isset ($_COOKIE['ftitle'])&&$_COOKIE['ftitle']=='closed'):?>
<script>
    $(function(){
        $('.ftitle').click();
    });
</script>
<?endif;?>