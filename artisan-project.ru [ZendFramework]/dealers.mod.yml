tables:
  dealers:
    fields:
      id: {type: int, notnull: 1, unsigned: 1, auto_increment: 1}
      cdate: {type: datetime, am: {type: datetime, title: Дата создания дилера}}
      mdate: {type: datetime, am: {type: datetime, title: Дата редактирования дилера}}
      ch_pass_date: {type: datetime, am: {type: datetime, title: Дата смены пароля дилером}}
      login: {type: varchar, length: 32, notnull: 1, am: {type: login, req: 1, title: Логин}}
      pass: {type: varchar, length: 32, notnull: 1, am: {type: pass, req: 1, htmltype: pass, title: Пароль}}
      blocked: {type: "enum('yes','no')", default: 'no', notnull: 1, am: {type: string, title: Доступ к системе, otitle: Запретить, htmltype: checkbox, default: 'no', checked: 'yes', values: {no: доступ разрешен, yes: доступ запрещен}}}
      deleted: {type: "enum('yes','no')", default: 'no', notnull: 1, am: {type: string, title: Удалить, otitle: Удалить, htmltype: checkbox, default: 'no', checked: 'yes', values: {no: доступ разрешен, yes: Удален}}}
      title: {type: tinytext, notnull: 1, am: {type: string, title: Наименование}}
      city: {type: text, notnull: 1, am: {type: string, title: Город}}
      description: {type: tinytext, notnull: 0, am: {type: text, title: Описание}}
      mail: {type: tinytext, notnull: 1, am: {type: mail, title: Электронная почта}}
      category_id: {type: int, notnull: 1, unsigned: 1, am: {type: select, title: Категория дилера}}
      supplier_id: {type: int, notnull: 1, unsigned: 1, am: {type: select, title: Поставщик}}
      price_id: {foreign: 1, table: dealers_categories, field: price_id, use_ref: dealers2categories, am: 'dealers_categories->price_id'}

      have_discount: {foreign: 1, ref_to: {use_ref: dealers2categories, field: have_discount, table: dealers_categories}, am: 'dealers_categories->have_discount'}
      show_remains: {foreign: 1, ref_to: {use_ref: dealers2categories, field: show_remains, table: dealers_categories}, am: 'dealers_categories->show_remains'}
      legal_entities:
        virtual: 1
        ref_to:
          idFieldName: id
          virtual: 1
          table: ?_dealers_legal_entities
          fields: [id, phone, legal_entity, legal_address, actual_address, inn, current_account, bank, correspondent_account, bik]
          use_ref: dealers2legal_entities
        am: {title: Юридические лица}
    table:
      PRIMARY KEY: id
      KEYS:
        credentials: [login, pass, blocked, deleted]
        category_id: [category_id]
        supplier_id: [supplier_id]
    foreign:
      category_title: {table: dealers_categories, field: title, use_ref: dealers2categories, am: category_id}
      category_amount_of_discount: {table: dealers_categories, field: amount_of_discount, use_ref: dealers2categories, am: category_id}
      price_id: {table: dealers_categories, field: price_id, use_ref: dealers2categories, am: dealers_categories->price_id}
      supplier_title: {table: suppliers, field: title, use_ref: dealers2suppliers, am: supplier_id}
    actions:
      list: [id, category_title, login, mail, title, city, blocked]
      show: [cdate, mdate, category_title, title, city, login, pass, description, mail, blocked]
      add: [category_id, login, pass, title, city, description, mail, supplier_id, blocked]
      modify: [category_id, title, city, description, mail, supplier_id, blocked]
      change_pass: [pass]
      login: [login, pass]
      profile: [title, city, login, description, mail, legal_entities]
      edit-profile: [title, city, login, description, mail]
      complaint_form: [title, city]
      dealer: [id, cdate, mdate, ch_pass_date, login, pass, blocked, deleted, title, city, description, mail, category_id, supplier_id, price_id, have_discount, show_remains, legal_entities, category_title, category_amount_of_discount, supplier_title]

  dealers_legal_entities:
    fields:
      id: {type: int, notnull: 1, unsigned: 1, auto_increment: 1, am: {type: integer, title: ID юр.лица}}
      dealer_id: {type: int, notnull: 1, unsigned: 1, am: {type: select, title: Дилер}}
      phone: {type: tinytext, notnull: 1, am: {type: string, title: Телефон}}
      legal_entity: {type: tinytext, notnull: 1, am: {type: string, title: Юридическое лицо}}
      legal_address: {type: tinytext, notnull: 1, am: {type: string, title: Юридический адрес}}
      actual_address: {type: tinytext, notnull: 1, am: {type: string, title: Фактический адрес}}
      inn: {type: tinytext, notnull: 1, am: {type: string, title: ИНН/КПП}}
      current_account: {type: tinytext, notnull: 1, am: {type: string, title: Расчетный счет}}
      bank: {type: tinytext, notnull: 1, am: {type: string, title: Наименование банка}}
      correspondent_account: {type: tinytext, notnull: 1, am: {type: string, title: Корреспондентский счет}}
      bik: {type: tinytext, notnull: 1, am: {type: string, title: БИК}}
    table:
      PRIMARY KEY: id
      KEYS:
        dealer_id: [dealer_id]
    foreign:
      dealer_title: {table: dealers, field: title, use_ref: legal_entities2dealers, am: dealers->title}
    actions:
      list: [id, dealer_title, legal_entity]
      show: [id, phone, legal_entity, legal_address, actual_address, inn, bik, current_account, bank, correspondent_account]
      add: [phone, legal_entity, legal_address, actual_address, inn, bik, current_account, bank, correspondent_account]
      modify: [dealer_id, phone, legal_entity, legal_address, actual_address, inn, bik, current_account, bank, correspondent_account]
      profile: [phone, legal_entity, legal_address, actual_address, inn, bik, current_account, bank, correspondent_account]

  dealers_categories:
    fields:
      id: {type: int, notnull: 1, unsigned: 1, auto_increment: 1}
      title: {type: tinytext, notnull: 1, am: {type: string, title: Наименование}}
      have_discount: {type: "enum('yes','no')", default: 'no', notnull: 1, am: {type: string, title: Скидка, otitle: включить скидку, htmltype: checkbox, default: 'no', checked: 'yes', values: {no: нет, yes: да}}}
      show_remains: {type: "enum('yes','no')", default: 'no', notnull: 1, am: {type: string, title: Остатки, otitle: показывать, htmltype: checkbox, default: 'no', checked: 'yes', values: {no: нет, yes: да}}}
      price_id: {type: int, notnull: 1, unsigned: 1, am: {title: Цена, type: select}}
      amount_of_discount: {type: int, notnull: 1, unsigned: 1, am: {title: Размер скидки(%), type: string}}
    foreign:
      price_title: {table: prices, field: title, use_ref: categories2prices, am: price_id}
    table:
      PRIMARY KEY: id
    actions:
      list: [id, title, have_discount, amount_of_discount, show_remains, price_title]
      show: [title, have_discount, amount_of_discount, show_remains, price_title]
      add: [title, have_discount, amount_of_discount, show_remains, price_id]
      modify: [title, have_discount, amount_of_discount, show_remains, price_id]

  prices:
    dont_install: 1
    fields:
      id: {type: tinyint, notnull: 1, unsigned: 1, auto_increment: 1}
      title: {type: varchar, length: 32, am: {title: Название, type: string}}

  suppliers:
    fields:
      id: {type: int, notnull: 1, unsigned: 1, auto_increment: 1}
      title: {type: tinytext, notnull: 1, am: {type: string, title: Наименование организации}}
      legal_address: {type: tinytext, notnull: 1, am: {type: string, title: Юридический адрес}}
      actual_address: {type: tinytext, notnull: 1, am: {type: string, title: Фактический адрес}}
      inn: {type: tinytext, notnull: 1, am: {type: string, title: ИНН}}
      kpp: {type: tinytext, notnull: 1, am: {type: string, title: КПП}}
      bik: {type: tinytext, notnull: 1, am: {type: string, title: БИК}}
      bank: {type: tinytext, notnull: 1, am: {type: string, title: Наименование банка}}
      phone: {type: tinytext, notnull: 1, am: {type: string, title: Телефон}}
      current_account: {type: tinytext, notnull: 1, am: {type: string, title: Расчетный счет}}
      correspondent_account: {type: tinytext, notnull: 1, am: {type: string, title: Корреспондентский счет}}
      director_general: {type: tinytext, notnull: 1, am: {type: string, title: Генеральный директор}}
      chief_accountant: {type: tinytext, notnull: 1, am: {type: string, title: Главный бухгалтер}}
    table:
      PRIMARY KEY: id
    actions:
      list: [id, title, bank]
      show: [title, legal_address, actual_address, inn, kpp, bik, current_account, bank, phone, correspondent_account, director_general, chief_accountant]
      print: [title, legal_address, actual_address, inn, kpp, bik, current_account, bank, phone, correspondent_account, director_general, chief_accountant]
      add: [title, legal_address, actual_address, inn, kpp, bik, current_account, bank, phone, correspondent_account, director_general, chief_accountant]
      modify: [title, legal_address, actual_address, inn, kpp, bik, current_account, bank, phone, correspondent_account, director_general, chief_accountant]

  dealers_login_stats:
    fields:
      dealer_id: {type: int, notnull: 1, unsigned: 1}
      date: {type: timestamp, notnull: 1}
    table:
      KEYS:
        dealer_id: [dealer_id, date]
refs:
  dealers2categories: {type: M-1, join: left, tables: {dealers: category_id, dealers_categories: id}}
  legal_entities2dealers: {type: M-1, join: left, tables: {dealers: id, dealers_legal_entities: dealer_id}}
  dealers2suppliers: {type: M-1, join: left, tables: {dealers: supplier_id, suppliers: id}}
  categories2prices: {type: M-1, join: left, tables: {dealers_categories: price_id, prices: id}}
  dealers2legal_entities:
    virtual: 1
    join: left
    type: N-M
    tables:
      -
        - {table: dealers, field: id}
        - {table: dealers_legal_entities, field: dealer_id}
#, cond: {dealer_id: dealers.id}
